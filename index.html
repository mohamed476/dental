<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nivel 6: ¡Habla como local!</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f8f9fa;--card:#ffffff;--accent:#dc3545;--muted:#6c757d;--success:#198754;--warning:#ffc107;--danger:#dc3545;--energy:#c82333;
      font-family: "Poppins", sans-serif;
    }
    body{margin:0;background:linear-gradient(180deg,#f8f9fa, #fff);display:flex;flex-direction:column;align-items:center;min-height:100vh;color:#212529}
    
    /* TIMER ROMÁNTICO */
    .timer-banner{
      width:100%;background:linear-gradient(135deg,#dc3545,#e74c3c);color:white;padding:22px 0;text-align:center;font-weight:900;
      font-size:38px;letter-spacing:2px;box-shadow:0 8px 25px rgba(220,53,69,0.35);z-index:10;
    }
    .timer-banner .heart{font-size:48px;color:#fff;animation:beat 1.2s infinite;margin:0 10px;}
    @keyframes beat{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
    .timer-banner .countdown{display:flex;justify-content:center;gap:22px;flex-wrap:wrap;margin-top:12px}
    .timer-banner .block{background:rgba(255,255,255,0.18);padding:14px 22px;border-radius:14px;min-width:110px;border:1px solid rgba(255,255,255,0.25)}
    .timer-banner .num{font-size:52px;line-height:1;font-weight:900}
    .timer-banner .label{font-size:17px;text-transform:uppercase;letter-spacing:1.2px;margin-top:6px}
    .timer-banner .footer{font-size:20px;font-weight:600;margin-top:10px;opacity:0.95}

    .wrap{width:960px;max-width:96%;background:var(--card);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,0.08);overflow:hidden;margin:20px 0}
    header{padding:22px 28px;background:linear-gradient(90deg,rgba(220,53,69,0.12),rgba(220,53,69,0.04));display:flex;flex-direction:column;align-items:flex-start;gap:8px}
    header h1{margin:0;font-size:22px;color:#111}
    .date{font-size:18px;color:var(--accent);font-weight:bold;align-self:flex-end}
    .motivation{font-size:15px;color:#444;margin-top:6px;line-height:1.4}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;padding:20px}
    .card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05);margin-bottom:14px}
    .section-title{font-size:17px;font-weight:700;margin:0 0 12px;color:var(--accent);display:flex;align-items:center;gap:8px}
    .list{display:flex;flex-direction:column;gap:10px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;border:1px solid #f5c6cb}
    .big{font-weight:700;font-size:18px}
    .small{font-size:13px;color:var(--muted)}
    .lang{font-size:13px;color:var(--muted)}
    button{background:var(--accent);color:white;border:0;padding:8px 14px;border-radius:10px;cursor:pointer;font-size:14px;display:inline-flex;align-items:center;gap:6px;transition:all .2s}
    button:hover{transform:scale(1.05);box-shadow:0 4px 8px rgba(220,53,69,0.3)}
    .btn-sm{font-size:12px;padding:5px 8px}
    .btn-success{background:var(--success)}
    .btn-warning{background:var(--warning);color:#212529}
    .btn-danger{background:var(--danger)}
    .verbs{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .verb-card{padding:14px;border:1px solid #f8b4b4;border-radius:10px;background:#fff5f5}
    footer{padding:14px 20px;background:#f8f9fa;text-align:center;color:var(--muted);font-size:13px}
    .lightbulb{font-size:26px;color:var(--accent)}
    .game-area{background:#ffeaea;padding:16px;border-radius:12px;margin-top:12px;border:1px dashed #dc3545}
    .sentence-builder{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
    .word-chip{background:#fff;padding:8px 12px;border-radius:20px;border:1px solid #f5c6cb;font-size:14px;cursor:grab;box-shadow:0 1px 3px rgba(0,0,0,0.1);user-select:none;transition:all .2s}
    .word-chip:hover{transform:scale(1.05);border-color:var(--accent)}
    .drop-zone{min-height:50px;border:2px dashed #ccc;border-radius:10px;padding:10px;display:flex;flex-wrap:wrap;gap:6px;background:#fff}
    .drop-zone.drag-over{border-color:var(--accent);background:#ffeaea}
    .result{margin-top:12px;font-weight:600;font-size:15px}
    .voice-btn{background:var(--accent);color:white;padding:6px 10px;border-radius:50%;font-size:18px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
    .voice-btn:hover{transform:scale(1.1);background:#c82333}
    .progress{margin-top:10px;height:8px;background:#f5c6cb;border-radius:4px;overflow:hidden}
    .progress-bar{height:100%;background:var(--accent);width:0%;transition:width 0.4s ease}
    .confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:100}
    .game-tabs{display:flex;gap:8px;margin-bottom:12px;border-bottom:1px solid #f5c6cb;flex-wrap:wrap}
    .tab-btn{padding:8px 16px;border-radius:8px 8px 0 0;background:#fdf2f2;color:var(--muted);cursor:pointer;font-size:14px;transition:all .2s}
    .tab-btn:hover{background:#f8caca}
    .tab-btn.active{background:var(--accent);color:white}
    .game-content{display:none;padding:8px}
    .game-content.active{display:block}
    .dialog-line{font-size:15px;padding:10px;border:1px solid #f5c6cb;border-radius:10px;margin:8px 0;background:#fff5f5}
    .dialog-line span{font-weight:600;color:var(--accent)}

    /* BOTÓN MY GOAL */
    .goal-btn{
      position: fixed; bottom: 20px; right: 20px; background: #ff6b6b; color: white; border: none;
      font-size: 1.1rem; padding: 14px 20px; border-radius: 50px; cursor: pointer; box-shadow: 0 6px 15px rgba(255,107,107,0.4);
      z-index: 100; transition: all 0.3s ease; font-weight: 600;
    }
    .goal-btn:hover{transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255,107,107,0.5);}

    /* MODAL SNUS TRACKER */
    .modal{display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
      justify-content: center; align-items: center; z-index: 200; backdrop-filter: blur(8px);}
    .modal-content{
      background: linear-gradient(135deg, #7bdff2, #b2f7ef, #eff7f6); padding: 30px; border-radius: 20px;
      text-align: center; max-width: 400px; width: 90%; box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      animation: popIn 0.4s ease; position: relative;
    }
    @keyframes popIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
    .modal h2{font-size: 2rem; margin: 0 0 10px;}
    .modal .counter{font-size: 5rem; font-weight: bold; color: #ff6b6b; margin: 15px 0;}
    .modal button{background: #ff6b6b; border: none; color: white; font-size: 1.1rem; padding: 12px 24px; border-radius: 50px;
      cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.2s ease;}
    .modal button:hover{transform: scale(1.05); background: #ff8787;}
    .modal .close-btn{position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #555;}
    .modal .message{margin-top: 12px; font-size: 1rem; color: #444;}
    .modal .emoji{font-size: 2.5rem; margin-top: 10px;}

    @media(max-width:800px){
      .timer-banner{font-size:26px}
      .timer-banner .num{font-size:38px}
      .grid{grid-template-columns:1fr}
      .goal-btn{right:15px;bottom:15px;font-size:1rem;padding:12px 16px;}
    }
  </style>
</head>
<body>

  <!-- TIMER ROMÁNTICO -->
  <div class="timer-banner">
    <div>FALTAN <span class="heart">Corazón</span> PARA ABRAZARTE</div>
    <div class="countdown">
      <div class="block"><div class="num" id="days">00</div><div class="label">días</div></div>
      <div class="block"><div class="num" id="hours">00</div><div class="label">horas</div></div>
      <div class="block"><div class="num" id="minutes">00</div><div class="label">minutos</div></div>
      <div class="block"><div class="num" id="seconds">00</div><div class="label">segundos</div></div>
    </div>
    <div class="footer">28/12/2025 • 10:30 AM <span class="heart">Corazón</span> Barcelona</div>
  </div>

  <!-- BOTÓN MY GOAL -->
  <button class="goal-btn" id="openGoal">My Goal</button>

  <!-- MODAL SNUS TRACKER -->
  <div class="modal" id="snusModal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">×</span>
      <h2>Daily Snus Tracker</h2>
      <p>Goal: max 15 snus</p>
      <div class="counter" id="snusCounter">15</div>
      <button id="useSnus">Used one</button>
      <div class="message" id="snusMessage"></div>
      <div class="emoji" id="snusEmoji">Relajado</div>
    </div>
  </div>

  <div class="wrap">
    <header>
      <h1>Nivel 6: ¡Formar frases y diálogos!</h1>
      <div class="date" id="todayDate"></div>
      <p class="motivation">¡Silje, hoy hablas como local! <br>
      <strong>Objetivo: Construir diálogos reales en Barcelona</strong> <br>
      1. Frases listas <br>
      2. Construye diálogos <br>
      3. Habla con Amine <br>
      <span style="color:#dc3545">Corazón</span> ¡Te espero!</p>
    </header>

    <div class="grid">
      <div>
        <!-- FRASES ÚTILES -->
        <div class="card">
          <h3 class="section-title">Frases para Barcelona</h3>
          <div class="list">
            <div class="item"><div class="big">¿Dónde está la playa?</div><div class="lang">Where is the beach?</div></div>
            <div class="item"><div class="big">Quiero un café con leche</div><div class="lang">I want a coffee with milk</div></div>
            <div class="item"><div class="big">¿A qué hora llega el metro?</div><div class="lang">What time does the metro arrive?</div></div>
            <div class="item"><div class="big">Me gustaría una mesa para dos</div><div class="lang">I'd like a table for two</div></div>
            <div class="item"><div class="big">¿Puedes repetir, por favor?</div><div class="lang">Can you repeat, please?</div></div>
          </div>
        </div>

        <!-- CONSTRUYE DIÁLOGO -->
        <div class="card">
          <h3 class="section-title">Construye el diálogo</h3>
          <div class="game-area">
            <p><strong>Arrastra las frases para formar un diálogo natural</strong></p>
            <div class="sentence-builder" id="dialogPool"></div>
            <div class="drop-zone" id="dialogDrop"></div>
            <div class="result" id="dialogResult"></div>
            <button id="checkDialog" class="btn-sm">Comprobar</button>
            <button id="voiceDialog" class="voice-btn">Altavoz</button>
          </div>
        </div>

        <!-- VERBOS CLAVE -->
        <div class="card">
          <h3 class="section-title">Verbos para hablar</h3>
          <div class="verbs">
            <div class="verb-card"><div class="big">querer</div><div class="lang">quiero • quieres • quiere</div></div>
            <div class="verb-card"><div class="big">poder</div><div class="lang">puedo • puedes • puede</div></div>
            <div class="verb-card"><div class="big">ir</div><div class="lang">voy • vas • va</div></div>
            <div class="verb-card"><div class="big">tener</div><div class="lang">tengo • tienes • tiene</div></div>
          </div>
        </div>

        <!-- JUEGO: COMPLETA EL DIÁLOGO -->
        <div class="card">
          <h3 class="section-title">Completa con Amine</h3>
          <div class="game-area">
            <div class="dialog-line">Amine: <span>¡Hola! ¿De dónde eres?</span></div>
            <div class="dialog-line">Tú: <span id="q1">_____</span> <button class="btn-sm" onclick="chooseAnswer(1,'Soy de Noruega')">Soy de Noruega</button> <button class="btn-sm" onclick="chooseAnswer(1,'Me llamo Silje')">Me llamo Silje</button></div>
            <div class="dialog-line">Amine: <span>¡Qué guay! ¿Te gusta Barcelona?</span></div>
            <div class="dialog-line">Tú: <span id="q2">_____</span> <button class="btn-sm" onclick="chooseAnswer(2,'Sí, mucho')">Sí, mucho</button> <button class="btn-sm" onclick="chooseAnswer(2,'No hablo español')">No hablo español</button></div>
            <div class="result" id="dialogScore"></div>
          </div>
        </div>
      </div>

      <aside>
        <div class="card">
          <h3>Diálogos reales</h3>
          <div style="display:flex;flex-direction:column;gap:12px">
            <div class="item"><div class="big">En el bar</div><div class="lang">— Una caña, por favor<br>— ¿Algo más?<br>— No, gracias</div></div>
            <div class="item"><div class="big">En la playa</div><div class="lang">— ¿Está fría el agua?<br>— ¡Un poco! Pero entra</div></div>
          </div>
        </div>
        <div class="card" style="text-align:center">
          <div class="lightbulb">Bombilla</div>
          <p class="small">Puntos: <strong id="totalPoints">0</strong> pts</p>
          <p class="small">¡Cada diálogo = 1 paso más cerca!</p>
        </div>
      </aside>
    </div>

    <footer>
      <span>Hecho con amor — ¡pronto hablaremos cara a cara!</span>
    </footer>
  </div>

  <canvas class="confetti" id="confetti"></canvas>

  <script>
    // === FECHA ===
    document.getElementById('todayDate').textContent = new Date().toLocaleDateString('es-ES', {weekday:'long', day:'numeric', month:'long'});

    // === TIMER ===
    const targetDate = new Date('2025-12-28T10:30:00');
    function updateTimer() {
      const now = new Date();
      const diff = targetDate - now;
      if (diff <= 0) {
        document.querySelector('.timer-banner').innerHTML = `<div style="font-size:36px">¡YA ESTOY AQUÍ, SILJE! <span class="heart">Corazón</span></div>`;
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById('days').textContent = String(days).padStart(2, '0');
      document.getElementById('hours').textContent = String(hours).padStart(2, '0');
      document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
      document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
    }
    setInterval(updateTimer, 1000);
    updateTimer();

    // === SNUS TRACKER ===
    const modal = document.getElementById('snusModal');
    const openBtn = document.getElementById('openGoal');
    const closeBtn = document.getElementById('closeModal');
    const snusCounter = document.getElementById('snusCounter');
    const snusMessage = document.getElementById('snusMessage');
    const snusEmoji = document.getElementById('snusEmoji');
    const useBtn = document.getElementById('useSnus');
    let snusCount = 15;
    const today = new Date().toDateString();

    if (localStorage.getItem("snusDate") === today) {
      snusCount = parseInt(localStorage.getItem("snusCount")) || 15;
    } else {
      localStorage.setItem("snusDate", today);
      localStorage.setItem("snusCount", 15);
    }
    snusCounter.textContent = snusCount;

    openBtn.onclick = () => { modal.style.display = "flex"; updateSnusUI(); };
    closeBtn.onclick = () => { modal.style.display = "none"; };
    window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

    useBtn.onclick = () => {
      if (snusCount > 0) {
        snusCount--;
        snusCounter.textContent = snusCount;
        localStorage.setItem("snusCount", snusCount);
        updateSnusUI();
      }
    };

    function updateSnusUI() {
      if (snusCount === 0) {
        snusMessage.textContent = "You did it! No snus left";
        snusEmoji.textContent = "Fuego";
      } else if (snusCount <= 5) {
        snusMessage.textContent = "Careful... almost out";
        snusEmoji.textContent = "Mirando";
      } else {
        snusMessage.textContent = "Keep it up";
        snusEmoji.textContent = "Relajado";
      }
    }

    // === DIÁLOGO CONSTRUCCIÓN ===
    const dialogLines = [
      "¡Hola! ¿De dónde eres?",
      "Soy de Noruega",
      "¡Qué guay! ¿Te gusta Barcelona?",
      "Sí, mucho",
      "¡Genial! ¿Quieres un café?"
    ];
    const correctOrder = [0,1,2,3,4];
    let currentOrder = [];

    const pool = document.getElementById('dialogPool');
    const drop = document.getElementById('dialogDrop');
    const result = document.getElementById('dialogResult');
    const checkBtn = document.getElementById('checkDialog');
    const voiceBtn = document.getElementById('voiceDialog');

    function loadDialog() {
      const shuffled = [...dialogLines].sort(() => Math.random() - 0.5);
      pool.innerHTML = ''; drop.innerHTML = ''; result.textContent = '';
      currentOrder = [];

      shuffled.forEach(line => {
        const chip = document.createElement('div');
        chip.className = 'word-chip';
        chip.textContent = line;
        chip.draggable = true;
        chip.ondragstart = e => e.dataTransfer.setData('text', line);
        chip.onclick = () => moveToDrop(chip);
        pool.appendChild(chip);
      });

      drop.ondragover = e => { e.preventDefault(); drop.classList.add('drag-over'); };
      drop.ondragleave = () => drop.classList.remove('drag-over');
      drop.ondrop = e => {
        e.preventDefault(); drop.classList.remove('drag-over');
        const line = e.dataTransfer.getData('text');
        if (line) addToDrop(line);
      };
    }

    function moveToDrop(chip) {
      const line = chip.textContent;
      if (!drop.querySelector(`[data-line="${line}"]`)) {
        addToDrop(line);
        chip.remove();
      }
    }

    function addToDrop(line) {
      const chip = document.createElement('div');
      chip.className = 'word-chip';
      chip.textContent = line;
      chip.dataset.line = line;
      chip.onclick = () => chip.remove();
      drop.appendChild(chip);
      currentOrder = Array.from(drop.children).map(c => dialogLines.indexOf(c.textContent));
    }

    checkBtn.onclick = () => {
      if (currentOrder.length !== correctOrder.length) {
        result.textContent = "Falta alguna frase...";
        result.style.color = 'var(--danger)';
        return;
      }
      if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
        result.innerHTML = `¡Diálogo perfecto! +3 pts`;
        result.style.color = 'var(--success)';
        totalPoints += 3;
        pointsEl.textContent = totalPoints;
        confettiBurst();
        setTimeout(loadDialog, 2000);
      } else {
        result.textContent = "Inténtalo de nuevo...";
        result.style.color = 'var(--danger)';
      }
    };

    voiceBtn.onclick = () => speak(dialogLines.join('. '));

    // === COMPLETA DIÁLOGO ===
    let answers = {};
    function chooseAnswer(q, text) {
      document.getElementById(`q${q}`).textContent = text;
      answers[q] = text;
      if (answers[1] && answers[2]) {
        const score = (answers[1] === "Soy de Noruega" ? 1 : 0) + (answers[2] === "Sí, mucho" ? 1 : 0);
        document.getElementById('dialogScore').textContent = score === 2 ? "¡Perfecto! +2 pts" : "Bien, pero puedes mejorar";
        document.getElementById('dialogScore').style.color = score === 2 ? 'var(--success)' : 'var(--warning)';
        if (score === 2) { totalPoints += 2; pointsEl.textContent = totalPoints; confettiBurst(); }
      }
    }

    // === PUNTOS ===
    let totalPoints = 0;
    const pointsEl = document.getElementById('totalPoints');

    // === VOZ ===
    function speak(text) {
      if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'es-ES';
        utter.rate = 0.9;
        speechSynthesis.speak(utter);
      }
    }

    // === CONFETTI ===
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = innerWidth; canvas.height = innerHeight;
    let particles = [];

    function confettiBurst() {
      for (let i = 0; i < 100; i++) {
        particles.push({
          x: innerWidth / 2 + (Math.random() - 0.5) * 300,
          y: innerHeight / 2 + (Math.random() - 0.5) * 200,
          vx: (Math.random() - 0.5) * 10,
          vy: Math.random() * -12 - 5,
          color: `hsl(${Math.random() * 60 + 330},100%,65%)`,
          size: Math.random() * 5 + 3,
          life: 80
        });
      }
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.3; p.life--;
        if (p.life <= 0) particles.splice(i, 1);
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      });
      requestAnimationFrame(animate);
    }
    animate();

    // === INICIO ===
    loadDialog();
  </script>
</body>
</html>
